# 概述
本工程旨在尝试各种实用中间件在stm32上的引入，同时通过一个简单的多级菜单案例来辅以学习标准状态机乃至后期的层次式状态机编程思想。当然，如果有机会，也可能会继续引入发布订阅机制之类的更加成熟完善的编程框架。  
特别注意，lw_queue队列库和lw_rb环形缓冲区库目前仅实现了读写隔离，只能保证不同线程间一读一写的数据安全。因此应当避免在主程序和中断间同时进行读取或写入操作，同时也非常建议所有中断的抢占优先级保持一致，避免中断间的线程安全问题。
# 详细的更新记录
## V1.0.0版本
### 这是该工程的首发版本，主要添加了一些基本的硬件驱动与中间件
* 引入江科大新OLED驱动V2.0，该驱动将屏幕内容的绘制与显示分离开，实现良好的解耦性。  
* 从cubemx添加适用于F4的ARM DSP库，默认使用浮点运算指令以实现更快速的浮点数运算。  
* 引入中间件flexible button库V2.0.1，该库目前是rt thread软件生态的一部分。  
* 引入MultiTimer库V2.0，这是一个简单易用的软件定时器库。   

## V1.2.0版本
### 这是该工程的第三个版本，第二个版本因为某些原因已被弃用
### 有何更改
* 在原来的基础上，继续增加letter shell、lw pid、malloc中间件。
* 为了更好地适配letter shell，移除了调试串口的DMA支持，同时将调试串口的接收功能直接对接到串口中断回调上，而不使用HAL库自带的回调函数。
* 自行实现了lw_pid中间件，目前仅支持普通增量式pid与普通位置式pid的计算。
* malloc中间件目前已将芯片内部sdram的一部分空间与ccm ram的所有空间纳入管理。
* 调整了物理按键的扫描顺序以缓解flexible button库按键扫描逆序的情况。
* letter shell目前使用自制的存储实在数据的队列结构充当输入缓冲区。

## V1.3.0版本
### 有何更改
* 出于可移植性的考虑，取消了对malloc中间件的支持。转而使用tlsf开源内存管理库，并将ccm内存区的前30kb空间纳入内存池进行管理。  
* 自行实现并引入了lw_queue中间件，提供了基本的动态分配的队列机制。  
* 在原有基础上对lw_pid中间件的代码框架进行重构，实现了更深层次的面向对象。  
* 通过cubemx软件引入了st官方编写的用于解决线程安全的方案，目前采取的是该解决方案的第二个策略，即允许中断使用互斥锁，同时中断可能会被阻塞。  
* 出于效率与线程安全的考虑，不为letter shell的串口数据接收适配lw_queue中间件。  
* 将自行编写的外设驱动代码从cubemx软件所生成的文件中剥离开来，防止因意外操作造成代码缺损。
* 参照QPC编程框架的编码风格，基于事件驱动与标准状态机（有限状态机）编写了一个简单的多级菜单案例。  

## V2.0.0版本
### 有何更改
* 自行实现了一个线程安全的环形缓冲区库lw_rb并为letter shell进行适配。
* 优化了队列库lw_queue的实现，现在它是线程安全的。
* 引入了cJSON中间件并为其适配tlsf内存管理函数。
* 引入了zorb_framework框架并为其适配tlsf内存管理函数，可以辅助实现层次状态机。  
